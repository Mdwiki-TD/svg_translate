{% extends "base.html" %}

{% block title %}All Tasks Â· SVG Translate Bot{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
    <h1 class="h3 mb-0">All Tasks</h1>
    <form class="row g-2 align-items-center" method="get" role="search">
        <div class="col-auto">
            <label class="form-label mb-0" for="status">Status</label>
        </div>
        <div class="col-auto">
            <select class="form-select" id="status" name="status">
                <option value="">All statuses</option>
                {% for status in available_statuses %}
                <option value="{{ status }}" {% if status_filter == status %}selected{% endif %}>{{ status }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-outline-primary">Filter</button>
        </div>
    </form>
</div>
<div class="table-responsive">
    <table id="tasks-table" class="table table-striped table-hover align-middle" style="width:100%">
        <thead>
            <tr>
                <th scope="col">Task ID</th>
                <th scope="col">Title</th>
                <th scope="col">Status</th>
                <th scope="col">Files Ready</th>
                <th scope="col">New Translations</th>
                <th scope="col">Created</th>
                <th scope="col">Updated</th>
                <th scope="col">User</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>
                    <code title="{{ task.id }}">
                        <!-- short task.id to 10 charters -->
                        {{ task.id[:10] }}...
                    </code>
                </td>
                <td class="text-break">
                    <a href="{{ url_for('task1', task_id=task.id) }}" class="text-decoration-none">
                        {{ task.title }}
                    </a>
                </td>
                <td>
                    <span
                        class="badge {% if task.status in ['Completed', 'Failed', 'Running'] %}bg-{{ 'success' if task.status == 'Completed' else 'danger' if task.status == 'Failed' else 'primary' }}{% else %}bg-secondary{% endif %}">{{ task.status }}</span>
                </td>
                <td>{{ task.files_to_upload_count }}</td>
                <td>{{ task.new_translations_count }}</td>
                <td data-order="{{ task.created_at_sort }}">{{ task.created_at_display }}</td>
                <td data-order="{{ task.updated_at_sort }}">{{ task.updated_at_display }}</td>
                <td>{{ task.user or "" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
<script>
    $(document).ready(function () {
        $('#tasks-table').DataTable({
            responsive: true,
            pageLength: 25,
            order: [[5, 'desc']],
            columnDefs: [
                { targets: 0, responsivePriority: 1 },
                { targets: 1, responsivePriority: 2 },
                { targets: [3, 4], className: 'text-center' }
            ]
        });
    });
</script>
{% endblock %}
